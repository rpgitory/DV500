#!/bin/bash
#Shipping 


CART_SERVER_IPADDRESS=
MYSQL_SERVER_IPADDRESS=

yum install maven -y

useradd roboshop
mkdir /app
curl -L -o /tmp/shipping.zip https://roboshop-artifacts.s3.amazonaws.com/shipping.zip
cd /app
unzip /tmp/shipping.zip
cd /app
mvn clean package
mv target/shipping-1.0.jar shipping.ja

echo '[Unit]
Description=Shipping Service

[Service]
User=roboshop
Environment=CART_ENDPOINT=$CART_SERVER_IPADDRESS:8080
Environment=DB_HOST=$MYSQL_SERVER_IPADDRESS
ExecStart=/bin/java -jar /app/shipping.jar
SyslogIdentifier=shipping

[Install]
WantedBy=multi-user.target
' > /etc/systemd/system/shipping.service

systemctl daemon-reload
systemctl enable shipping
systemctl start shipping

yum install mysql -y

mysql -h MYSQL_SERVER_IPADDRESS -uroot -pRoboShop@1 < /app/schema/shipping.sql


#Do not forget change Shipping ip in frontend